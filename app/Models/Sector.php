<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\SoftDeletes;
use Illuminate\Support\Str;

class Sector extends Model
{
    use HasFactory,SoftDeletes;

    protected $table = 'sectors';
    protected $fillable = [
        'title',
        'description',
        'photo_path',
        'featured_photo_path',
        'icon_path',
        'featured_icon_path',
        'is_active',
        'order',
        'slug',
        'visit_count',
    ];

    protected $dates    = [ 'deleted_at'];

    protected $casts    = [
        'title'             => 'array',
        'description'       => 'array',
        'slug'              => 'array',
    ];

    protected static function boot()
    {
        parent::boot(); // TODO: Change the autogenerated stub


        self::creating(function ($model){
            $slugs  = [];
            foreach ($model->title as $key => $title){
                $slugs[$key] = Str::slug($title,'-');
            }
            $model->slug = $slugs;
        });

        self::created(function($model){
            $model->order       = $model->id;
            $model->visit_count = 0;
            $model->save();
        });

        self::updating(function ($model){
            $slugs  = [];
            foreach ($model->title as $key => $title){
                $slugs[$key] = Str::slug($title,'-');
            }
            $model->slug = $slugs;
        });

    }
}
